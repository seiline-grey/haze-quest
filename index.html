<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Haze:Coin - –ö–≤–µ—Å—Ç –¥–ª—è —Ñ–æ—Ä—É–º–∞</title>
    <style>
        :root {
            --dark-bg: #1a1a2e;
            --darker-bg: #16213e;
            --accent: #ff6b6b;
            --primary: #667eea;
            --secondary: #764ba2;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Georgia', serif;
            background: linear-gradient(135deg, var(--dark-bg) 0%, var(--darker-bg) 100%);
            color: #e0e0e0;
            line-height: 1.6;
            min-height: 100vh;
            padding: 20px;
        }
        
        .game-container {
            max-width: 1000px;
            margin: 0 auto;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            border: 1px solid #333;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--accent);
        }
        
        .header h1 {
            color: var(--accent);
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .header h2 {
            color: var(--primary);
            font-weight: normal;
        }
        
        .game-content {
            display: flex;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        @media (max-width: 768px) {
            .game-content {
                flex-direction: column;
            }
        }
        
        .scene-image {
            flex: 1;
            min-width: 300px;
            background: #000;
            border-radius: 10px;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #888;
            font-size: 18px;
        }
        
        .scene-text {
            flex: 2;
            background: rgba(255, 255, 255, 0.05);
            padding: 25px;
            border-radius: 10px;
            font-size: 18px;
            line-height: 1.8;
        }
        
        .stats {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin: 20px 0;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
        }
        
        .stat-item {
            padding: 8px 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .stat-icon {
            color: #ffc107;
        }
        
        .choices {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-top: 25px;
        }
        
        .choice-btn {
            padding: 15px 20px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            text-align: left;
            transition: all 0.3s ease;
        }
        
        .choice-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        .keyword-section {
            background: rgba(255, 193, 7, 0.1);
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border: 2px dashed #ffc107;
        }
        
        .keyword-display {
            background: rgba(0, 0, 0, 0.5);
            padding: 15px;
            border-radius: 6px;
            margin: 15px 0;
            font-family: monospace;
            word-break: break-all;
        }
        
        .controls {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 30px;
        }
        
        .control-btn {
            padding: 10px 20px;
            background: #28a745;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }
        
        .control-btn.secondary {
            background: #6c757d;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            background: #28a745;
            color: white;
            border-radius: 5px;
            animation: slideIn 0.3s ease;
            z-index: 1000;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); }
            to { transform: translateX(0); }
        }
        
        .character {
            position: absolute;
            bottom: 0;
            max-height: 70%;
            transition: all 0.5s ease;
        }
        
        .character.left {
            left: 10%;
        }
        
        .character.right {
            right: 10%;
        }
        
        .character.center {
            left: 50%;
            transform: translateX(-50%);
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="header">
            <h1>üéÆ Haze:Coin</h1>
            <h2>–ö–≤–µ—Å—Ç –¥–ª—è —Ñ–æ—Ä—É–º–∞ Haze - –¢–µ—Å—Ç–æ–≤–∞—è –≤–µ—Ä—Å–∏—è</h2>
            <div id="player-info" style="margin-top: 10px; color: #aaa;">
                –ò–≥—Ä–æ–∫: <span id="current-player">–Ω–µ –≤—ã–±—Ä–∞–Ω</span>
            </div>
        </div>
        
        <div class="stats" id="game-stats">
            <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ JS -->
        </div>
        
        <div class="game-content">
            <div class="scene-image" id="scene-image">
                <div style="text-align: center;">
                    <div style="font-size: 48px; margin-bottom: 20px;">üè∞</div>
                    <div>–ó–¥–µ—Å—å –±—É–¥–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—Ü–µ–Ω—ã</div>
                </div>
                <div id="characters-container"></div>
            </div>
            
            <div class="scene-text" id="scene-text">
                <p>–ó–∞–≥—Ä—É–∑–∫–∞ –∏–≥—Ä—ã...</p>
            </div>
        </div>
        
        <div class="choices" id="choices-container">
            <!-- –ö–Ω–æ–ø–∫–∏ –≤—ã–±–æ—Ä–∞ –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å -->
        </div>
        
        <div class="keyword-section" id="keyword-section" style="display: none;">
            <h3 style="color: #ffc107; margin-bottom: 15px;">üìù –ö–ª—é—á–µ–≤–∞—è —Ñ—Ä–∞–∑–∞</h3>
            <input type="text" id="keyword-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–ª—é—á–µ–≤—É—é —Ñ—Ä–∞–∑—É –æ—Ç –¥—Ä—É–≥–æ–≥–æ –∏–≥—Ä–æ–∫–∞" 
                   style="width: 100%; padding: 12px; margin: 10px 0; border-radius: 5px; border: 1px solid #666; background: rgba(255,255,255,0.1); color: white;">
            <button onclick="applyKeyword()" class="choice-btn">üîë –ü—Ä–∏–º–µ–Ω–∏—Ç—å –∫–ª—é—á–µ–≤—É—é —Ñ—Ä–∞–∑—É</button>
        </div>
        
        <div class="controls">
            <button onclick="saveGame()" class="control-btn">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–≥—Ä—É</button>
            <button onclick="showGameLog()" class="control-btn secondary">üìú –ü–æ–∫–∞–∑–∞—Ç—å –ª–æ–≥</button>
            <button onclick="resetGame()" class="control-btn secondary">üîÑ –°–±—Ä–æ—Å–∏—Ç—å –∏–≥—Ä—É</button>
        </div>
        
        <div style="margin-top: 30px; text-align: center; color: #888; font-size: 14px;">
            <p>–ü—Ä–æ–µ–∫—Ç: <strong>seiline-grey.github.io/haze-quest</strong></p>
            <p>–≠—Ç–æ —Ç–µ—Å—Ç–æ–≤–∞—è –≤–µ—Ä—Å–∏—è. –ü–æ–ª–Ω–∞—è –∏–≥—Ä–∞ —Å–∫–æ—Ä–æ –±—É–¥–µ—Ç –≥–æ—Ç–æ–≤–∞!</p>
        </div>
    </div>

    <script>
        // –ò–≥—Ä–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
        let gameData = {
            currentPlayer: null,
            currentCircle: 1,
            currentScene: 'start',
            players: {},
            stats: {
                coins: 0,
                knowledge: 0,
                luck: 1,
                curse: false
            },
            choices: {},
            gameLog: []
        };

        // –ò–≥—Ä–æ–≤—ã–µ —Å—Ü–µ–Ω—ã
        const scenes = {
            start: {
                text: `
                    <h3 style="color: #667eea;">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ Haze:Coin!</h3>
                    <p>–≠—Ç–æ –∫–≤–µ—Å—Ç –¥–ª—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∏–≥—Ä–æ–∫–æ–≤ —Å —Å–∏—Å—Ç–µ–º–æ–π –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤.</p>
                    <p>–ö–∞–∂–¥—ã–π –∏–≥—Ä–æ–∫ –¥–µ–ª–∞–µ—Ç —Å–≤–æ–π —Ö–æ–¥, –∑–∞—Ç–µ–º –ø–µ—Ä–µ–¥–∞—ë—Ç –∫–ª—é—á–µ–≤—É—é —Ñ—Ä–∞–∑—É —Å–ª–µ–¥—É—é—â–µ–º—É.</p>
                    <p>–í—ã–±–µ—Ä–∏—Ç–µ, –∑–∞ –∫–æ–≥–æ –≤—ã –∏–≥—Ä–∞–µ—Ç–µ:</p>
                `,
                choices: [
                    { text: 'üé≠ –ò–≥—Ä–∞—Ç—å –∑–∞ –ò—Å–∫–∞—Ç–µ–ª—è (–ø–µ—Ä–≤—ã–π –∏–≥—Ä–æ–∫)', action: 'selectPlayer', player: 'player1' },
                    { text: 'üìñ –ò–≥—Ä–∞—Ç—å –∑–∞ –•—Ä–∞–Ω–∏—Ç–µ–ª—è (–≤—Ç–æ—Ä–æ–π –∏–≥—Ä–æ–∫)', action: 'selectPlayer', player: 'player2' },
                    { text: 'üíæ –ó–∞–≥—Ä—É–∑–∏—Ç—å —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—É—é –∏–≥—Ä—É', action: 'loadGamePrompt' }
                ]
            },
            
            player1_start: {
                text: `
                    <h3 style="color: #ff6b6b;">–ö—Ä—É–≥ 1 - –ò—Å–∫–∞—Ç–µ–ª—å</h3>
                    <p>–í—ã —Å—Ç–æ–∏—Ç–µ –ø–µ—Ä–µ–¥ —Å—Ç–∞—Ä—ã–º –æ—Å–æ–±–Ω—è–∫–æ–º. –í–µ—Ç–µ—Ä —à–µ–ø—á–µ—Ç —Å—Ç—Ä–∞–Ω–Ω—ã–µ —Å–ª–æ–≤–∞...</p>
                    <p>–õ—É–Ω–∞ –æ—Å–≤–µ—â–∞–µ—Ç —Ñ–∞—Å–∞–¥ –∑–¥–∞–Ω–∏—è, –≤ –æ–¥–Ω–æ–º –∏–∑ –æ–∫–æ–Ω –º–µ—Ä—Ü–∞–µ—Ç —Ç—É—Å–∫–ª—ã–π —Å–≤–µ—Ç.</p>
                    <p>–ß—Ç–æ –≤—ã –ø—Ä–µ–¥–ø—Ä–∏–º–µ—Ç–µ?</p>
                `,
                choices: [
                    { text: 'üîç –¢—â–∞—Ç–µ–ª—å–Ω–æ –æ–±—ã—Å–∫–∞—Ç—å —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏—é –≤–æ–∫—Ä—É–≥ –≤—Ö–æ–¥–∞', next: 'player1_search' },
                    { text: 'üö™ –†–µ—à–∏—Ç–µ–ª—å–Ω–æ –ø–æ—Å—Ç—É—á–∞—Ç—å –≤ –º–∞—Å—Å–∏–≤–Ω—É—é –¥—É–±–æ–≤—É—é –¥–≤–µ—Ä—å', next: 'player1_knock' },
                    { text: '‚è≥ –û—Å—Ç–æ—Ä–æ–∂–Ω–æ –ø–æ–¥–æ–∂–¥–∞—Ç—å, –Ω–∞–±–ª—é–¥–∞—è –∑–∞ –æ–∫—Ä—É–∂–µ–Ω–∏–µ–º', next: 'player1_wait' }
                ]
            },
            
            player1_search: {
                text: `
                    <h3>–ü–æ–∏—Å–∫–∏ –≤–æ–∫—Ä—É–≥ –æ—Å–æ–±–Ω—è–∫–∞</h3>
                    <p>–í—ã —Ç—â–∞—Ç–µ–ª—å–Ω–æ –æ—Å–º–∞—Ç—Ä–∏–≤–∞–µ—Ç–µ —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏—é –≤–æ–∫—Ä—É–≥ –≤—Ö–æ–¥–∞.</p>
                    <p>–ü–æ–¥ —Å—Ç–∞—Ä—ã–º –∫–∞–º–µ–Ω–Ω—ã–º –≥–æ—Ä—à–∫–æ–º –Ω–∞—Ö–æ–¥–∏—Ç–µ —Å—Ç—Ä–∞–Ω–Ω—É—é –º–æ–Ω–µ—Ç—É...</p>
                    <p style="color: #ffc107;">üéâ –ú–æ–Ω–µ—Ç–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å!</p>
                `,
                onShow: () => {
                    gameData.stats.coins += 1;
                    addToLog('–ù–∞–π–¥–µ–Ω–∞ —Å—Ç—Ä–∞–Ω–Ω–∞—è –º–æ–Ω–µ—Ç–∞ –≤–æ–∑–ª–µ –≤—Ö–æ–¥–∞');
                    showKeyword();
                }
            },
            
            player2_start: {
                text: `
                    <h3 style="color: #4ecdc4;">–ö—Ä—É–≥ 1 - –•—Ä–∞–Ω–∏—Ç–µ–ª—å</h3>
                    <p>–í–≤–µ–¥–∏—Ç–µ –∫–ª—é—á–µ–≤—É—é —Ñ—Ä–∞–∑—É –æ—Ç –ò—Å–∫–∞—Ç–µ–ª—è:</p>
                `,
                showKeywordInput: true
            }
        };

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã
        function initGame() {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
            const saved = localStorage.getItem('hazeCoinSave');
            if (saved) {
                try {
                    gameData = JSON.parse(saved);
                    showNotification('–ò–≥—Ä–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞ –∏–∑ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è!');
                } catch (e) {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:', e);
                }
            }
            
            showScene('start');
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ü–µ–Ω—É
        function showScene(sceneId) {
            const scene = scenes[sceneId];
            if (!scene) {
                document.getElementById('scene-text').innerHTML = '<p>–°—Ü–µ–Ω–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞</p>';
                return;
            }
            
            gameData.currentScene = sceneId;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç
            document.getElementById('scene-text').innerHTML = scene.text;
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—ã–±–æ—Ä—ã
            const choicesContainer = document.getElementById('choices-container');
            if (scene.choices && scene.choices.length > 0) {
                let choicesHtml = '';
                scene.choices.forEach(choice => {
                    const action = choice.action ? `onclick="${choice.action}('${choice.player || ''}')"` 
                                               : `onclick="makeChoice('${choice.next}')"`;
                    choicesHtml += `<button class="choice-btn" ${action}>${choice.text}</button>`;
                });
                choicesContainer.innerHTML = choicesHtml;
            } else {
                choicesContainer.innerHTML = '';
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–ª–µ –¥–ª—è –∫–ª—é—á–µ–≤–æ–π —Ñ—Ä–∞–∑—ã
            if (scene.showKeywordInput) {
                document.getElementById('keyword-section').style.display = 'block';
            } else {
                document.getElementById('keyword-section').style.display = 'none';
            }
            
            // –í—ã–ø–æ–ª–Ω—è–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è
            if (scene.onShow) scene.onShow();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
            updateStats();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –∏–≥—Ä–æ–∫–µ
            updatePlayerInfo();
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º
            saveToStorage();
        }

        // –í—ã–±—Ä–∞—Ç—å –∏–≥—Ä–æ–∫–∞
        function selectPlayer(playerId) {
            const playerName = prompt('–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è:', playerId === 'player1' ? '–ò—Å–∫–∞—Ç–µ–ª—å' : '–•—Ä–∞–Ω–∏—Ç–µ–ª—å');
            gameData.currentPlayer = playerId;
            gameData.players[playerId] = {
                name: playerName || playerId,
                role: playerId === 'player1' ? '–ò—Å–∫–∞—Ç–µ–ª—å' : '–•—Ä–∞–Ω–∏—Ç–µ–ª—å'
            };
            
            addToLog(`${playerName} –Ω–∞—á–∏–Ω–∞–µ—Ç –∏–≥—Ä—É –≤ —Ä–æ–ª–∏ ${gameData.players[playerId].role}`);
            showScene(playerId + '_start');
        }

        // –°–¥–µ–ª–∞—Ç—å –≤—ã–±–æ—Ä
        function makeChoice(nextScene) {
            addToLog('–°–¥–µ–ª–∞–Ω –≤—ã–±–æ—Ä: –ø–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ª–µ–¥—É—é—â–µ–π —Å—Ü–µ–Ω–µ');
            showScene(nextScene);
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –∫–ª—é—á–µ–≤—É—é —Ñ—Ä–∞–∑—É
        function showKeyword() {
            const keyword = generateKeyword();
            document.getElementById('keyword-section').style.display = 'block';
            document.getElementById('keyword-input').value = keyword;
            
            document.getElementById('scene-text').innerHTML += `
                <div class="keyword-display">
                    <strong>–í–∞—à–∞ –∫–ª—é—á–µ–≤–∞—è —Ñ—Ä–∞–∑–∞ –¥–ª—è –¥—Ä—É–≥–æ–≥–æ –∏–≥—Ä–æ–∫–∞:</strong><br>
                    ${keyword}
                </div>
                <p style="color: #ffc107; margin-top: 10px;">üì§ –ü–µ—Ä–µ–¥–∞–π—Ç–µ —ç—Ç—É —Ñ—Ä–∞–∑—É —Å–æ–∏–≥—Ä–æ–∫—É!</p>
            `;
        }

        // –ü—Ä–∏–º–µ–Ω–∏—Ç—å –∫–ª—é—á–µ–≤—É—é —Ñ—Ä–∞–∑—É
        function applyKeyword() {
            const keyword = document.getElementById('keyword-input').value;
            if (!keyword) {
                showNotification('–í–≤–µ–¥–∏—Ç–µ –∫–ª—é—á–µ–≤—É—é —Ñ—Ä–∞–∑—É!', 'error');
                return;
            }
            
            try {
                const data = decodeKeyword(keyword);
                // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –æ—Ç –¥—Ä—É–≥–æ–≥–æ –∏–≥—Ä–æ–∫–∞
                showNotification('–ö–ª—é—á–µ–≤–∞—è —Ñ—Ä–∞–∑–∞ —É—Å–ø–µ—à–Ω–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∞!');
                addToLog('–ü—Ä–∏–º–µ–Ω–µ–Ω–∞ –∫–ª—é—á–µ–≤–∞—è —Ñ—Ä–∞–∑–∞ –æ—Ç –¥—Ä—É–≥–æ–≥–æ –∏–≥—Ä–æ–∫–∞');
                
                // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–π —Å—Ü–µ–Ω–µ
                if (gameData.currentPlayer === 'player2') {
                    showScene('player2_action');
                }
                
            } catch (error) {
                showNotification('–û—à–∏–±–∫–∞ –≤ –∫–ª—é—á–µ–≤–æ–π —Ñ—Ä–∞–∑–µ!', 'error');
            }
        }

        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª—é—á–µ–≤–æ–π —Ñ—Ä–∞–∑—ã
        function generateKeyword() {
            const data = {
                player: gameData.currentPlayer,
                circle: gameData.currentCircle,
                stats: gameData.stats,
                scene: gameData.currentScene
            };
            return btoa(JSON.stringify(data));
        }

        // –î–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–ª—é—á–µ–≤–æ–π —Ñ—Ä–∞–∑—ã
        function decodeKeyword(keyword) {
            try {
                return JSON.parse(atob(keyword));
            } catch (e) {
                throw new Error('–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –∫–ª—é—á–µ–≤–æ–π —Ñ—Ä–∞–∑—ã');
            }
        }

        // –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
        function updateStats() {
            const statsContainer = document.getElementById('game-stats');
            let statsHtml = '';
            
            Object.entries(gameData.stats).forEach(([key, value]) => {
                let icon = 'üìä';
                if (key === 'coins') icon = 'üí∞';
                if (key === 'knowledge') icon = 'üìö';
                if (key === 'luck') icon = 'üçÄ';
                if (key === 'curse') {
                    statsHtml += `<div class="stat-item"><span class="stat-icon">‚ö°</span><span>–ü—Ä–æ–∫–ª—è—Ç–∏–µ: ${value ? '–î–∞' : '–ù–µ—Ç'}</span></div>`;
                } else {
                    statsHtml += `<div class="stat-item"><span class="stat-icon">${icon}</span><span>${key}: ${value}</span></div>`;
                }
            });
            
            statsContainer.innerHTML = statsHtml;
        }

        // –û–±–Ω–æ–≤–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –∏–≥—Ä–æ–∫–µ
        function updatePlayerInfo() {
            const playerInfo = document.getElementById('current-player');
            if (gameData.currentPlayer && gameData.players[gameData.currentPlayer]) {
                playerInfo.textContent = `${gameData.players[gameData.currentPlayer].name} (${gameData.players[gameData.currentPlayer].role})`;
            } else {
                playerInfo.textContent = '–Ω–µ –≤—ã–±—Ä–∞–Ω';
            }
        }

        // –î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø–∏—Å—å –≤ –ª–æ–≥
        function addToLog(text) {
            gameData.gameLog.push({
                text: text,
                timestamp: new Date().toLocaleTimeString(),
                circle: gameData.currentCircle
            });
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –ª–æ–≥ –∏–≥—Ä—ã
        function showGameLog() {
            let logText = '=== –õ–æ–≥ –∏–≥—Ä—ã ===\n\n';
            gameData.gameLog.forEach(entry => {
                logText += `[${entry.timestamp}] ${entry.text}\n`;
            });
            alert(logText);
        }

        // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–≥—Ä—É
        function saveGame() {
            const saveCode = generateKeyword();
            const saveText = `–ö–æ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:\n\n${saveCode}\n\n–°–∫–æ–ø–∏—Ä—É–π—Ç–µ —ç—Ç–æ—Ç –∫–æ–¥ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏–≥—Ä—ã –ø–æ–∑–∂–µ.`;
            
            document.getElementById('scene-text').innerHTML = `
                <h3>üíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–≥—Ä—ã</h3>
                <div class="keyword-display">${saveCode}</div>
                <p>–°–∫–æ–ø–∏—Ä—É–π—Ç–µ —ç—Ç–æ—Ç –∫–æ–¥ –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ –µ–≥–æ –≤ –Ω–∞–¥—ë–∂–Ω–æ–º –º–µ—Å—Ç–µ!</p>
                <button class="choice-btn" onclick="copyToClipboard('${saveCode}')">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥</button>
                <button class="choice-btn" onclick="showScene('${gameData.currentScene}')">‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –∏–≥—Ä–µ</button>
            `;
            
            saveToStorage();
            showNotification('–ò–≥—Ä–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞!');
        }

        // –ó–∞–≥—Ä—É–∑–∏—Ç—å –∏–≥—Ä—É
        function loadGamePrompt() {
            const saveCode = prompt('–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:');
            if (saveCode) {
                try {
                    const data = decodeKeyword(saveCode);
                    gameData = data;
                    updateStats();
                    updatePlayerInfo();
                    showNotification('–ò–≥—Ä–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞!');
                    showScene(gameData.currentScene);
                } catch (e) {
                    showNotification('–ù–µ–≤–µ—Ä–Ω—ã–π –∫–æ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è!', 'error');
                }
            }
        }

        // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ localStorage
        function saveToStorage() {
            localStorage.setItem('hazeCoinSave', JSON.stringify(gameData));
        }

        // –°–±—Ä–æ—Å–∏—Ç—å –∏–≥—Ä—É
        function resetGame() {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã? –í–µ—Å—å –ø—Ä–æ–≥—Ä–µ—Å—Å –±—É–¥–µ—Ç –ø–æ—Ç–µ—Ä—è–Ω.')) {
                localStorage.removeItem('hazeCoinSave');
                gameData = {
                    currentPlayer: null,
                    currentCircle: 1,
                    currentScene: 'start',
                    players: {},
                    stats: { coins: 0, knowledge: 0, luck: 1, curse: false },
                    choices: {},
                    gameLog: []
                };
                showScene('start');
                showNotification('–ò–≥—Ä–∞ —Å–±—Ä–æ—à–µ–Ω–∞');
            }
        }

        // –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤ –±—É—Ñ–µ—Ä
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                showNotification('–ö–æ–¥ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω!');
            }).catch(() => {
                const textarea = document.createElement('textarea');
                textarea.value = text;
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand('copy');
                document.body.removeChild(textarea);
                showNotification('–ö–æ–¥ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω!');
            });
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = 'notification';
            if (type === 'error') {
                notification.style.background = '#dc3545';
            }
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 3000);
        }

        // –ó–∞–ø—É—Å–∫ –∏–≥—Ä—ã
        document.addEventListener('DOMContentLoaded', initGame);
    </script>
</body>
</html>